<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- diff html gen, (c) Stephane Rodriguez - feb 2003 -->
<HTML>
<HEAD>
<TITLE> File Diff </TITLE>
<style type='text/css'>
<!--
.N { background-color:white; }
.C { background-color:#FFFFBB; }
.A { background-color:#BBFFBB; }
.D { background-color:#FFBBBB; }
-->
</style>
</HEAD>

<BODY BGCOLOR='#FFFFFF'>

<font size=-1><b>Files are identical.</font><br><table border=0 bgcolor=0 cellpadding=1 cellspacing=1 width=100%><tr><td>
<table width=100% bgcolor=white border=0 cellpadding=0 cellspacing=0>
<tr bgColor='#EEEEEE' style='color:0'><td width=50%>old version</td><td width=50%>new version&nbsp;&nbsp;&nbsp;(<b style='background-color:#FFFFBB;width:20'>&nbsp;</b>changed&nbsp;&nbsp;<b style='background-color:#BBFFBB;width:20'>&nbsp;</b>added&nbsp;&nbsp;<b style='background-color:#FFBBBB;width:20'>&nbsp;</b>deleted)&nbsp;&nbsp;<FORM ACTION='' style='display:inline'><SELECT id='fontoptions' onchange='maintable.style.fontSize=this.options[this.selectedIndex].value'><option value='6pt'>6pt<option value='7pt'>7pt<option value='8pt'>8pt<option value='9pt' selected>9pt</SELECT> </FORM></td></tr>
<tr bgColor='#EEEEEE' style='color:0'><td width=50%><code>C:\Users\mmichael\Documents\GitHub\Apprenda-TFS-Integration\TaskBuild\common\common.ps1</code></td><td width=50%><code>C:\Users\mmichael\Documents\GitHub\Apprenda-TFS-Integration\TaskBuild\apprendatasks\apprendaDeploy\common.ps1</code></td></tr></table>
</td></tr>
</table>

<br>

<table border=0 bgcolor=0 cellpadding=1 cellspacing=1 width=100%><tr><td><table id='maintable' width=100% bgcolor='white' cellpadding=0 cellspacing=0 border=0 style='color:#888888;font-family: Courier New, Helvetica, sans-serif; font-size: 8pt'>
<tr><td width=50%><b>0</b> ﻿function FormatURL($requestURI, $cloudurl, [ref]$responseURL)</td><td width=50%><b>0</b> ﻿function FormatURL($requestURI, $cloudurl, [ref]$responseURL)</td></tr><tr><td width=50%><b>1</b> {</td><td width=50%><b>1</b> {</td></tr><tr><td width=50%><b>2</b> &nbsp;&nbsp;&nbsp;&nbsp;$PlatformURL = $cloudurl</td><td width=50%><b>2</b> &nbsp;&nbsp;&nbsp;&nbsp;$PlatformURL = $cloudurl</td></tr><tr><td width=50%><b>3</b> &nbsp;&nbsp;&nbsp;&nbsp;if($PlatformURL.ToLower().EndsWith("/")) { $PlatformURL = $PlatformURL.TrimEnd("/") }</td><td width=50%><b>3</b> &nbsp;&nbsp;&nbsp;&nbsp;if($PlatformURL.ToLower().EndsWith("/")) { $PlatformURL = $PlatformURL.TrimEnd("/") }</td></tr><tr><td width=50%><b>4</b> &nbsp;&nbsp;&nbsp;&nbsp;if($PlatformURL.ToLower().StartsWith("https://")) { $responseURL.value = $PlatformURL + $requestURI }</td><td width=50%><b>4</b> &nbsp;&nbsp;&nbsp;&nbsp;if($PlatformURL.ToLower().StartsWith("https://")) { $responseURL.value = $PlatformURL + $requestURI }</td></tr><tr><td width=50%><b>5</b> &nbsp;&nbsp;&nbsp;&nbsp;elseif ($PlatformURL.ToLower().StartsWith("http://")) { $responseURL.value = $PlatformURL.Replace("http://", "https://") + $requestURI }</td><td width=50%><b>5</b> &nbsp;&nbsp;&nbsp;&nbsp;elseif ($PlatformURL.ToLower().StartsWith("http://")) { $responseURL.value = $PlatformURL.Replace("http://", "https://") + $requestURI }</td></tr><tr><td width=50%><b>6</b> &nbsp;&nbsp;&nbsp;&nbsp;else { $responseURL.value = "https://" + $PlatformURL + $requestURI }</td><td width=50%><b>6</b> &nbsp;&nbsp;&nbsp;&nbsp;else { $responseURL.value = "https://" + $PlatformURL + $requestURI }</td></tr><tr><td width=50%><b>7</b> }</td><td width=50%><b>7</b> }</td></tr><tr><td width=50%><b>8</b> &nbsp;</td><td width=50%><b>8</b> &nbsp;</td></tr><tr><td width=50%><b>9</b> function FormatAuthBody ($Username, $Password, $tenantAlias)</td><td width=50%><b>9</b> function FormatAuthBody ($Username, $Password, $tenantAlias)</td></tr><tr><td width=50%><b>10</b> {</td><td width=50%><b>10</b> {</td></tr><tr><td width=50%><b>11</b> &nbsp;&nbsp;&nbsp;&nbsp;$devAuthJSON = "{`"username`":`"$Username`",`"password`":`"$Password`",`"tenantAlias`":`"$tenantAlias`"}"</td><td width=50%><b>11</b> &nbsp;&nbsp;&nbsp;&nbsp;$devAuthJSON = "{`"username`":`"$Username`",`"password`":`"$Password`",`"tenantAlias`":`"$tenantAlias`"}"</td></tr><tr><td width=50%><b>12</b> &nbsp;&nbsp;&nbsp;&nbsp;return $devAuthJSON</td><td width=50%><b>12</b> &nbsp;&nbsp;&nbsp;&nbsp;return $devAuthJSON</td></tr><tr><td width=50%><b>13</b> }</td><td width=50%><b>13</b> }</td></tr><tr><td width=50%><b>14</b> &nbsp;</td><td width=50%><b>14</b> &nbsp;</td></tr><tr><td width=50%><b>15</b> function GetSessionToken($body)</td><td width=50%><b>15</b> function GetSessionToken($body)</td></tr><tr><td width=50%><b>16</b> {</td><td width=50%><b>16</b> {</td></tr><tr><td width=50%><b>17</b> &nbsp;&nbsp;&nbsp;&nbsp;try</td><td width=50%><b>17</b> &nbsp;&nbsp;&nbsp;&nbsp;try</td></tr><tr><td width=50%><b>18</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>18</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>19</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Starting authentication method to Apprenda Environment."</td><td width=50%><b>19</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Starting authentication method to Apprenda Environment."</td></tr><tr><td width=50%><b>20</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$jsonOutput = Invoke-RestMethod -Uri $global:authURI -Method Post -ContentType "application/json" -Body $body -TimeoutSec 600</td><td width=50%><b>20</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$jsonOutput = Invoke-RestMethod -Uri $global:authURI -Method Post -ContentType "application/json" -Body $body -TimeoutSec 600</td></tr><tr><td width=50%><b>21</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$global:ApprendaSessiontoken = $jsonOutput.apprendaSessionToken</td><td width=50%><b>21</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$global:ApprendaSessiontoken = $jsonOutput.apprendaSessionToken</td></tr><tr><td width=50%><b>22</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Write-Host "The Apprenda session token is: '$global:ApprendaSessiontoken'"</td><td width=50%><b>22</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Write-Host "The Apprenda session token is: '$global:ApprendaSessiontoken'"</td></tr><tr><td width=50%><b>23</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>23</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>24</b> &nbsp;&nbsp;&nbsp;&nbsp;catch [System.Exception]</td><td width=50%><b>24</b> &nbsp;&nbsp;&nbsp;&nbsp;catch [System.Exception]</td></tr><tr><td width=50%><b>25</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>25</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>26</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exceptionMessage = $_.Exception.ToString()</td><td width=50%><b>26</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exceptionMessage = $_.Exception.ToString()</td></tr><tr><td width=50%><b>27</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Error "Caught exception $exceptionMessage during execution of GetSessionToken for URI '$global:authURI'. Skipping Tenant..."</td><td width=50%><b>27</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Error "Caught exception $exceptionMessage during execution of GetSessionToken for URI '$global:authURI'. Skipping Tenant..."</td></tr><tr><td width=50%><b>28</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>28</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>29</b> }</td><td width=50%><b>29</b> }</td></tr><tr><td width=50%><b>30</b> &nbsp;</td><td width=50%><b>30</b> &nbsp;</td></tr><tr><td width=50%><b>31</b> &nbsp;</td><td width=50%><b>31</b> &nbsp;</td></tr><tr><td width=50%><b>32</b> function CreateNewApplication($alias, $name, $description)</td><td width=50%><b>32</b> function CreateNewApplication($alias, $name, $description)</td></tr><tr><td width=50%><b>33</b> {</td><td width=50%><b>33</b> {</td></tr><tr><td width=50%><b>34</b> &nbsp;&nbsp;&nbsp;&nbsp;try</td><td width=50%><b>34</b> &nbsp;&nbsp;&nbsp;&nbsp;try</td></tr><tr><td width=50%><b>35</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>35</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>36</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($name.Length -eq 0){</td><td width=50%><b>36</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($name.Length -eq 0){</td></tr><tr><td width=50%><b>37</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $alias;</td><td width=50%><b>37</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $alias;</td></tr><tr><td width=50%><b>38</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>38</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>39</b> &nbsp;</td><td width=50%><b>39</b> &nbsp;</td></tr><tr><td width=50%><b>40</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$appsBody = "{`"Name`":`"$($name)`",`"Alias`":`"$($alias)`",`"Description`":`"$($description)`"}"</td><td width=50%><b>40</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$appsBody = "{`"Name`":`"$($name)`",`"Alias`":`"$($alias)`",`"Description`":`"$($description)`"}"</td></tr><tr><td width=50%><b>41</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoke-WebRpc $global:appsURI $appsBody</td><td width=50%><b>41</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoke-WebRpc $global:appsURI $appsBody</td></tr><tr><td width=50%><b>42</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Created '$($alias)' application."</td><td width=50%><b>42</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Created '$($alias)' application."</td></tr><tr><td width=50%><b>43</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>43</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>44</b> &nbsp;&nbsp;&nbsp;&nbsp;catch [System.Exception]</td><td width=50%><b>44</b> &nbsp;&nbsp;&nbsp;&nbsp;catch [System.Exception]</td></tr><tr><td width=50%><b>45</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>45</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>46</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exceptionMessage = $_.Exception.ToString()</td><td width=50%><b>46</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exceptionMessage = $_.Exception.ToString()</td></tr><tr><td width=50%><b>47</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Caught exception $exceptionMessage during execution of CreateApps for App '$($alias)'." -ForegroundColor Red -BackgroundColor Black</td><td width=50%><b>47</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Caught exception $exceptionMessage during execution of CreateApps for App '$($alias)'." -ForegroundColor Red -BackgroundColor Black</td></tr><tr><td width=50%><b>48</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host ""</td><td width=50%><b>48</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host ""</td></tr><tr><td width=50%><b>49</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td><td width=50%><b>49</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td></tr><tr><td width=50%><b>50</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>50</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>51</b> }</td><td width=50%><b>51</b> }</td></tr><tr><td width=50%><b>52</b> &nbsp;</td><td width=50%><b>52</b> &nbsp;</td></tr><tr><td width=50%><b>53</b> function GetResponseStreamAsJson($response)</td><td width=50%><b>53</b> function GetResponseStreamAsJson($response)</td></tr><tr><td width=50%><b>54</b> {</td><td width=50%><b>54</b> {</td></tr><tr><td width=50%><b>55</b> &nbsp;&nbsp;&nbsp;&nbsp;$stream = $null;</td><td width=50%><b>55</b> &nbsp;&nbsp;&nbsp;&nbsp;$stream = $null;</td></tr><tr><td width=50%><b>56</b> &nbsp;</td><td width=50%><b>56</b> &nbsp;</td></tr><tr><td width=50%><b>57</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($response -is [System.Net.HttpWebResponse])</td><td width=50%><b>57</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($response -is [System.Net.HttpWebResponse])</td></tr><tr><td width=50%><b>58</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>58</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>59</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stream = $response.GetResponseStream()</td><td width=50%><b>59</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stream = $response.GetResponseStream()</td></tr><tr><td width=50%><b>60</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$reader = new-object System.IO.StreamReader($stream)</td><td width=50%><b>60</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$reader = new-object System.IO.StreamReader($stream)</td></tr><tr><td width=50%><b>61</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($reader.BaseStream.CanSeek)</td><td width=50%><b>61</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($reader.BaseStream.CanSeek)</td></tr><tr><td width=50%><b>62</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>62</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>63</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$reader.BaseStream.Position = 0;</td><td width=50%><b>63</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$reader.BaseStream.Position = 0;</td></tr><tr><td width=50%><b>64</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>64</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>65</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$responseString = $reader.ReadToEnd();</td><td width=50%><b>65</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$responseString = $reader.ReadToEnd();</td></tr><tr><td width=50%><b>66</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Response String = " + $responseString</td><td width=50%><b>66</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Response String = " + $responseString</td></tr><tr><td width=50%><b>67</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $responseString | convertfrom-json</td><td width=50%><b>67</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $responseString | convertfrom-json</td></tr><tr><td width=50%><b>68</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>68</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>69</b> &nbsp;</td><td width=50%><b>69</b> &nbsp;</td></tr><tr><td width=50%><b>70</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($response -is [Microsoft.PowerShell.Commands.BasicHtmlWebResponseObject])</td><td width=50%><b>70</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($response -is [Microsoft.PowerShell.Commands.BasicHtmlWebResponseObject])</td></tr><tr><td width=50%><b>71</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>71</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>72</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Response Content = " + $($response.Content)</td><td width=50%><b>72</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Response Content = " + $($response.Content)</td></tr><tr><td width=50%><b>73</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $response.Content | convertfrom-json</td><td width=50%><b>73</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $response.Content | convertfrom-json</td></tr><tr><td width=50%><b>74</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>74</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>75</b> &nbsp;</td><td width=50%><b>75</b> &nbsp;</td></tr><tr><td width=50%><b>76</b> &nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Returning $null  - Response = " + $response</td><td width=50%><b>76</b> &nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Returning $null  - Response = " + $response</td></tr><tr><td width=50%><b>77</b> &nbsp;&nbsp;&nbsp;&nbsp;return $null</td><td width=50%><b>77</b> &nbsp;&nbsp;&nbsp;&nbsp;return $null</td></tr><tr><td width=50%><b>78</b> }</td><td width=50%><b>78</b> }</td></tr><tr><td width=50%><b>79</b> &nbsp;</td><td width=50%><b>79</b> &nbsp;</td></tr><tr><td width=50%><b>80</b> function CreateNewVersion($appAlias, $versionAlias, $versionName)</td><td width=50%><b>80</b> function CreateNewVersion($appAlias, $versionAlias, $versionName)</td></tr><tr><td width=50%><b>81</b> {</td><td width=50%><b>81</b> {</td></tr><tr><td width=50%><b>82</b> &nbsp;&nbsp;&nbsp;&nbsp;try</td><td width=50%><b>82</b> &nbsp;&nbsp;&nbsp;&nbsp;try</td></tr><tr><td width=50%><b>83</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>83</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>84</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$versionBody = "{`"Name`":`"$($versionName)`",`"Alias`":`"$($versionAlias)`",`"Description`":`"$($versionName)`"}"</td><td width=50%><b>84</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$versionBody = "{`"Name`":`"$($versionName)`",`"Alias`":`"$($versionAlias)`",`"Description`":`"$($versionName)`"}"</td></tr><tr><td width=50%><b>85</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uri = $global:versionsURI + '/' + $appAlias</td><td width=50%><b>85</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uri = $global:versionsURI + '/' + $appAlias</td></tr><tr><td width=50%><b>86</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoke-WebRequest -Uri $uri -Method POST -ContentType "application/json" -Headers $global:Headers -Body $versionBody -TimeoutSec 1200 -UseBasicParsing</td><td width=50%><b>86</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoke-WebRequest -Uri $uri -Method POST -ContentType "application/json" -Headers $global:Headers -Body $versionBody -TimeoutSec 1200 -UseBasicParsing</td></tr><tr><td width=50%><b>87</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Created Version '$($versionName)' with alias '$($versionAlias))' for '$($appAlias)'."</td><td width=50%><b>87</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Created Version '$($versionName)' with alias '$($versionAlias))' for '$($appAlias)'."</td></tr><tr><td width=50%><b>88</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>88</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>89</b> &nbsp;&nbsp;&nbsp;&nbsp;catch [System.Exception]</td><td width=50%><b>89</b> &nbsp;&nbsp;&nbsp;&nbsp;catch [System.Exception]</td></tr><tr><td width=50%><b>90</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>90</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>91</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exceptionMessage = $_.Exception.ToString()</td><td width=50%><b>91</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exceptionMessage = $_.Exception.ToString()</td></tr><tr><td width=50%><b>92</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Caught exception $exceptionMessage during execution of CreateVersion for Version '$($verInfo.alias)' of '$($appInfo.alias)'." -ForegroundColor Red -BackgroundColor Black</td><td width=50%><b>92</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Caught exception $exceptionMessage during execution of CreateVersion for Version '$($verInfo.alias)' of '$($appInfo.alias)'." -ForegroundColor Red -BackgroundColor Black</td></tr><tr><td width=50%><b>93</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host ""</td><td width=50%><b>93</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host ""</td></tr><tr><td width=50%><b>94</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td><td width=50%><b>94</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td></tr><tr><td width=50%><b>95</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>95</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>96</b> }</td><td width=50%><b>96</b> }</td></tr><tr><td width=50%><b>97</b> &nbsp;</td><td width=50%><b>97</b> &nbsp;</td></tr><tr><td width=50%><b>98</b> function UploadVersion($alias, $vAlias, $archive)</td><td width=50%><b>98</b> function UploadVersion($alias, $vAlias, $archive)</td></tr><tr><td width=50%><b>99</b> {</td><td width=50%><b>99</b> {</td></tr><tr><td width=50%><b>100</b> &nbsp;&nbsp;&nbsp;&nbsp;$uploadURI = $global:versionsURI + '/' + $alias + '/' + $vAlias + "?action=setArchive"</td><td width=50%><b>100</b> &nbsp;&nbsp;&nbsp;&nbsp;$uploadURI = $global:versionsURI + '/' + $alias + '/' + $vAlias + "?action=setArchive"</td></tr><tr><td width=50%><b>101</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri $uploadURI -Method POST -InFile $archive -ContentType "multipart/form-data" -Headers $global:Headers -TimeoutSec 3600 -UseBasicParsing</td><td width=50%><b>101</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri $uploadURI -Method POST -InFile $archive -ContentType "multipart/form-data" -Headers $global:Headers -TimeoutSec 3600 -UseBasicParsing</td></tr><tr><td width=50%><b>102</b> &nbsp;&nbsp;&nbsp;&nbsp;write-host Returned $response.StatusCode</td><td width=50%><b>102</b> &nbsp;&nbsp;&nbsp;&nbsp;write-host Returned $response.StatusCode</td></tr><tr><td width=50%><b>103</b> &nbsp;&nbsp;&nbsp;&nbsp;if($($response.StatusCode) -eq 200 )</td><td width=50%><b>103</b> &nbsp;&nbsp;&nbsp;&nbsp;if($($response.StatusCode) -eq 200 )</td></tr><tr><td width=50%><b>104</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>104</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>105</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Archive for '$($alias)' has been uploaded."</td><td width=50%><b>105</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "   Archive for '$($alias)' has been uploaded."</td></tr><tr><td width=50%><b>106</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host (GetResponseStreamAsJson $response)</td><td width=50%><b>106</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host (GetResponseStreamAsJson $response)</td></tr><tr><td width=50%><b>107</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>107</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>108</b> &nbsp;&nbsp;&nbsp;&nbsp;else</td><td width=50%><b>108</b> &nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td width=50%><b>109</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>109</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>110</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine("   Error Uploading Binaries for Application '$($appInfo.alias)'")</td><td width=50%><b>110</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine("   Error Uploading Binaries for Application '$($appInfo.alias)'")</td></tr><tr><td width=50%><b>111</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine($($responseObject.message))</td><td width=50%><b>111</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine($($responseObject.message))</td></tr><tr><td width=50%><b>112</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $false</td><td width=50%><b>112</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $false</td></tr><tr><td width=50%><b>113</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>113</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>114</b> }</td><td width=50%><b>114</b> }</td></tr><tr><td width=50%><b>115</b> &nbsp;</td><td width=50%><b>115</b> &nbsp;</td></tr><tr><td width=50%><b>116</b> function printReportCard($reportCard)</td><td width=50%><b>116</b> function printReportCard($reportCard)</td></tr><tr><td width=50%><b>117</b> {</td><td width=50%><b>117</b> {</td></tr><tr><td width=50%><b>118</b> &nbsp;</td><td width=50%><b>118</b> &nbsp;</td></tr><tr><td width=50%><b>119</b> &nbsp;&nbsp;&nbsp;&nbsp;$report = [System.Collections.ArrayList]@()</td><td width=50%><b>119</b> &nbsp;&nbsp;&nbsp;&nbsp;$report = [System.Collections.ArrayList]@()</td></tr><tr><td width=50%><b>120</b> &nbsp;&nbsp;&nbsp;&nbsp;foreach ($section in $reportCard.sections)</td><td width=50%><b>120</b> &nbsp;&nbsp;&nbsp;&nbsp;foreach ($section in $reportCard.sections)</td></tr><tr><td width=50%><b>121</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>121</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>122</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sectioned = $false</td><td width=50%><b>122</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sectioned = $false</td></tr><tr><td width=50%><b>123</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($message in $section.messages)</td><td width=50%><b>123</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($message in $section.messages)</td></tr><tr><td width=50%><b>124</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>124</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>125</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($message.severity -ne "Error")</td><td width=50%><b>125</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($message.severity -ne "Error")</td></tr><tr><td width=50%><b>126</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>126</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>127</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host -message "$($section.title)::$($message.message)"</td><td width=50%><b>127</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host -message "$($section.title)::$($message.message)"</td></tr><tr><td width=50%><b>128</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td><td width=50%><b>128</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td></tr><tr><td width=50%><b>129</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>129</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>130</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Error -Message "$($section.title)::$($message.message)"</td><td width=50%><b>130</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Error -Message "$($section.title)::$($message.message)"</td></tr><tr><td width=50%><b>131</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>131</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>132</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>132</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>133</b> }</td><td width=50%><b>133</b> }</td></tr><tr><td width=50%><b>134</b> &nbsp;</td><td width=50%><b>134</b> &nbsp;</td></tr><tr><td width=50%><b>135</b> function Invoke-WebRpc($uri, $content){</td><td width=50%><b>135</b> function Invoke-WebRpc($uri, $content){</td></tr><tr><td width=50%><b>136</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Invoking $uri with $content"</td><td width=50%><b>136</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Invoking $uri with $content"</td></tr><tr><td width=50%><b>137</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request = [System.Net.HttpWebRequest]::CreateHttp($uri)</td><td width=50%><b>137</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request = [System.Net.HttpWebRequest]::CreateHttp($uri)</td></tr><tr><td width=50%><b>138</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.Method = "POST"</td><td width=50%><b>138</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.Method = "POST"</td></tr><tr><td width=50%><b>139</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.Headers.Add("ApprendaSessionToken", $global:ApprendaSessiontoken)</td><td width=50%><b>139</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.Headers.Add("ApprendaSessionToken", $global:ApprendaSessiontoken)</td></tr><tr><td width=50%><b>140</b> &nbsp;</td><td width=50%><b>140</b> &nbsp;</td></tr><tr><td width=50%><b>141</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($content -ne $null)</td><td width=50%><b>141</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($content -ne $null)</td></tr><tr><td width=50%><b>142</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>142</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>143</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body = [byte[]][char[]]$content</td><td width=50%><b>143</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$body = [byte[]][char[]]$content</td></tr><tr><td width=50%><b>144</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.ContentLength = $body.Length</td><td width=50%><b>144</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.ContentLength = $body.Length</td></tr><tr><td width=50%><b>145</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.ContentType = "application/json"</td><td width=50%><b>145</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.ContentType = "application/json"</td></tr><tr><td width=50%><b>146</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Stream = $request.GetRequestStream();</td><td width=50%><b>146</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Stream = $request.GetRequestStream();</td></tr><tr><td width=50%><b>147</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Stream.Write($body, 0, $body.Length);</td><td width=50%><b>147</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Stream.Write($body, 0, $body.Length);</td></tr><tr><td width=50%><b>148</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>148</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>149</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td><td width=50%><b>149</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td width=50%><b>150</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>150</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>151</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.ContentLength = 0</td><td width=50%><b>151</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request.ContentLength = 0</td></tr><tr><td width=50%><b>152</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>152</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>153</b> &nbsp;</td><td width=50%><b>153</b> &nbsp;</td></tr><tr><td width=50%><b>154</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try</td><td width=50%><b>154</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try</td></tr><tr><td width=50%><b>155</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>155</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>156</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response = $request.GetResponse()</td><td width=50%><b>156</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$response = $request.GetResponse()</td></tr><tr><td width=50%><b>157</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return GetResponseStreamAsJson $response</td><td width=50%><b>157</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return GetResponseStreamAsJson $response</td></tr><tr><td width=50%><b>158</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>158</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>159</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch [System.Management.Automation.MethodInvocationException]</td><td width=50%><b>159</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch [System.Management.Automation.MethodInvocationException]</td></tr><tr><td width=50%><b>160</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>160</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>161</b> &nbsp;</td><td width=50%><b>161</b> &nbsp;</td></tr><tr><td width=50%><b>162</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#the WebException is the inner exception here</td><td width=50%><b>162</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#the WebException is the inner exception here</td></tr><tr><td width=50%><b>163</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$webException = [System.Net.WebException]$_.Exception.InnerException</td><td width=50%><b>163</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$webException = [System.Net.WebException]$_.Exception.InnerException</td></tr><tr><td width=50%><b>164</b> &nbsp;</td><td width=50%><b>164</b> &nbsp;</td></tr><tr><td width=50%><b>165</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($webException.Response -ne $null)</td><td width=50%><b>165</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($webException.Response -ne $null)</td></tr><tr><td width=50%><b>166</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>166</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>167</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$errorResponse = [System.Net.HttpWebResponse]$webException.Response</td><td width=50%><b>167</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$errorResponse = [System.Net.HttpWebResponse]$webException.Response</td></tr><tr><td width=50%><b>168</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return GetResponseStreamAsJson $errorResponse</td><td width=50%><b>168</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return GetResponseStreamAsJson $errorResponse</td></tr><tr><td width=50%><b>169</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>169</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>170</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>170</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>171</b> &nbsp;</td><td width=50%><b>171</b> &nbsp;</td></tr><tr><td width=50%><b>172</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $response</td><td width=50%><b>172</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $response</td></tr><tr><td width=50%><b>173</b> }</td><td width=50%><b>173</b> }</td></tr><tr><td width=50%><b>174</b> &nbsp;</td><td width=50%><b>174</b> &nbsp;</td></tr><tr><td width=50%><b>175</b> &nbsp;</td><td width=50%><b>175</b> &nbsp;</td></tr><tr><td width=50%><b>176</b> function PromoteVersion($alias, $versionAlias, $stage, $retainScalingSettings)</td><td width=50%><b>176</b> function PromoteVersion($alias, $versionAlias, $stage, $retainScalingSettings)</td></tr><tr><td width=50%><b>177</b> {</td><td width=50%><b>177</b> {</td></tr><tr><td width=50%><b>178</b> &nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Promoting application $alias version $versionAlias to stage $stage, retainScalingSettings = $retainScalingSettings"</td><td width=50%><b>178</b> &nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Promoting application $alias version $versionAlias to stage $stage, retainScalingSettings = $retainScalingSettings"</td></tr><tr><td width=50%><b>179</b> &nbsp;&nbsp;&nbsp;&nbsp;$promotionURI = $global:versionsURI + '/' + $alias + '/' + $versionAlias + "?action=promote&amp;stage=" + $stage</td><td width=50%><b>179</b> &nbsp;&nbsp;&nbsp;&nbsp;$promotionURI = $global:versionsURI + '/' + $alias + '/' + $versionAlias + "?action=promote&amp;stage=" + $stage</td></tr><tr><td width=50%><b>180</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($retainScalingSettings -eq $true -and $versionAlias -ne "v1" ){</td><td width=50%><b>180</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($retainScalingSettings -eq $true -and $versionAlias -ne "v1" ){</td></tr><tr><td width=50%><b>181</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$promotionUri = $promotionUri + "&amp;useScalingSettingsFrom=Published"</td><td width=50%><b>181</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$promotionUri = $promotionUri + "&amp;useScalingSettingsFrom=Published"</td></tr><tr><td width=50%><b>182</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Using Scaling Settings from Published Version"</td><td width=50%><b>182</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Using Scaling Settings from Published Version"</td></tr><tr><td width=50%><b>183</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>183</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>184</b> &nbsp;</td><td width=50%><b>184</b> &nbsp;</td></tr><tr><td width=50%><b>185</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRpc($promotionURI)</td><td width=50%><b>185</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRpc($promotionURI)</td></tr><tr><td width=50%><b>186</b> &nbsp;</td><td width=50%><b>186</b> &nbsp;</td></tr><tr><td width=50%><b>187</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($($response.success) -eq $true )</td><td width=50%><b>187</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($($response.success) -eq $true )</td></tr><tr><td width=50%><b>188</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>188</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>189</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Application '$alias' has been Promoted to the '$stage' stage." -ForegroundColor Green</td><td width=50%><b>189</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Application '$alias' has been Promoted to the '$stage' stage." -ForegroundColor Green</td></tr><tr><td width=50%><b>190</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0</td><td width=50%><b>190</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0</td></tr><tr><td width=50%><b>191</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>191</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>192</b> &nbsp;&nbsp;&nbsp;&nbsp;else</td><td width=50%><b>192</b> &nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td width=50%><b>193</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>193</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>194</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintReportCard $response</td><td width=50%><b>194</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintReportCard $response</td></tr><tr><td width=50%><b>195</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw "Error Promoting Application '$alias' version $versionAlias to the $stage stage."</td><td width=50%><b>195</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw "Error Promoting Application '$alias' version $versionAlias to the $stage stage."</td></tr><tr><td width=50%><b>196</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>196</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>197</b> }</td><td width=50%><b>197</b> }</td></tr><tr><td width=50%><b>198</b> &nbsp;</td><td width=50%><b>198</b> &nbsp;</td></tr><tr><td width=50%><b>199</b> # We can only demote from Sandbox to Definition, this is primarily needed for user action or patching a version.</td><td width=50%><b>199</b> # We can only demote from Sandbox to Definition, this is primarily needed for user action or patching a version.</td></tr><tr><td width=50%><b>200</b> function DemoteVersion($alias, $versionAlias)</td><td width=50%><b>200</b> function DemoteVersion($alias, $versionAlias)</td></tr><tr><td width=50%><b>201</b> {</td><td width=50%><b>201</b> {</td></tr><tr><td width=50%><b>202</b> &nbsp;&nbsp;&nbsp;&nbsp;$promotionURI = $global:versionsURI + '/' + $alias + '/' + $versionAlias + "?action=demote"</td><td width=50%><b>202</b> &nbsp;&nbsp;&nbsp;&nbsp;$promotionURI = $global:versionsURI + '/' + $alias + '/' + $versionAlias + "?action=demote"</td></tr><tr><td width=50%><b>203</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri $promotionURI -Method POST -ContentType "application/json" -Headers $global:Headers -TimeoutSec 3600 -UseBasicParsing</td><td width=50%><b>203</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri $promotionURI -Method POST -ContentType "application/json" -Headers $global:Headers -TimeoutSec 3600 -UseBasicParsing</td></tr><tr><td width=50%><b>204</b> &nbsp;</td><td width=50%><b>204</b> &nbsp;</td></tr><tr><td width=50%><b>205</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($($response.StatusCode) -eq 200 )</td><td width=50%><b>205</b> &nbsp;&nbsp;&nbsp;&nbsp;if ($($response.StatusCode) -eq 200 )</td></tr><tr><td width=50%><b>206</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>206</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>207</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Application '$alias' has been Demoted." -ForegroundColor Green</td><td width=50%><b>207</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Host "Application '$alias' has been Demoted." -ForegroundColor Green</td></tr><tr><td width=50%><b>208</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>208</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>209</b> &nbsp;&nbsp;&nbsp;&nbsp;else</td><td width=50%><b>209</b> &nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td width=50%><b>210</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>210</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>211</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine("Error Demoting Application '$alias' to the $stage stage.")</td><td width=50%><b>211</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine("Error Demoting Application '$alias' to the $stage stage.")</td></tr><tr><td width=50%><b>212</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine($($responseObject.message))</td><td width=50%><b>212</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Host.UI.WriteErrorLine($($responseObject.message))</td></tr><tr><td width=50%><b>213</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>213</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>214</b> }</td><td width=50%><b>214</b> }</td></tr><tr><td width=50%><b>215</b> &nbsp;</td><td width=50%><b>215</b> &nbsp;</td></tr><tr><td width=50%><b>216</b> &nbsp;</td><td width=50%><b>216</b> &nbsp;</td></tr><tr><td width=50%><b>217</b> function EnableTrustAllCerts{</td><td width=50%><b>217</b> function EnableTrustAllCerts{</td></tr><tr><td width=50%><b>218</b> &nbsp;&nbsp;&nbsp;&nbsp;add-type @"</td><td width=50%><b>218</b> &nbsp;&nbsp;&nbsp;&nbsp;add-type @"</td></tr><tr><td width=50%><b>219</b> &nbsp;&nbsp;&nbsp;&nbsp;using System.Net;</td><td width=50%><b>219</b> &nbsp;&nbsp;&nbsp;&nbsp;using System.Net;</td></tr><tr><td width=50%><b>220</b> &nbsp;&nbsp;&nbsp;&nbsp;using System.Security.Cryptography.X509Certificates;</td><td width=50%><b>220</b> &nbsp;&nbsp;&nbsp;&nbsp;using System.Security.Cryptography.X509Certificates;</td></tr><tr><td width=50%><b>221</b> &nbsp;&nbsp;&nbsp;&nbsp;public class TrustAllCertsPolicy : ICertificatePolicy {</td><td width=50%><b>221</b> &nbsp;&nbsp;&nbsp;&nbsp;public class TrustAllCertsPolicy : ICertificatePolicy {</td></tr><tr><td width=50%><b>222</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public bool CheckValidationResult(</td><td width=50%><b>222</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public bool CheckValidationResult(</td></tr><tr><td width=50%><b>223</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServicePoint srvPoint, X509Certificate certificate,</td><td width=50%><b>223</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServicePoint srvPoint, X509Certificate certificate,</td></tr><tr><td width=50%><b>224</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebRequest request, int certificateProblem) {</td><td width=50%><b>224</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebRequest request, int certificateProblem) {</td></tr><tr><td width=50%><b>225</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</td><td width=50%><b>225</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</td></tr><tr><td width=50%><b>226</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>226</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>227</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>227</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>228</b> "@</td><td width=50%><b>228</b> "@</td></tr><tr><td width=50%><b>229</b> [System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy</td><td width=50%><b>229</b> [System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy</td></tr><tr><td width=50%><b>230</b> }</td><td width=50%><b>230</b> }</td></tr><tr><td width=50%><b>231</b> function GetApplications()</td><td width=50%><b>231</b> function GetApplications()</td></tr><tr><td width=50%><b>232</b> {</td><td width=50%><b>232</b> {</td></tr><tr><td width=50%><b>233</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri $global:appsURI -Method GET -ContentType "application/json" -Headers $global:Headers -Timeoutsec 3600 -UseBasicParsing</td><td width=50%><b>233</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri $global:appsURI -Method GET -ContentType "application/json" -Headers $global:Headers -Timeoutsec 3600 -UseBasicParsing</td></tr><tr><td width=50%><b>234</b> &nbsp;&nbsp;&nbsp;&nbsp;if($($response.StatusCode) -eq 200 )</td><td width=50%><b>234</b> &nbsp;&nbsp;&nbsp;&nbsp;if($($response.StatusCode) -eq 200 )</td></tr><tr><td width=50%><b>235</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>235</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>236</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Write-Host $response</td><td width=50%><b>236</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Write-Host $response</td></tr><tr><td width=50%><b>237</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>237</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>238</b> &nbsp;&nbsp;&nbsp;&nbsp;return $response | ConvertFrom-Json</td><td width=50%><b>238</b> &nbsp;&nbsp;&nbsp;&nbsp;return $response | ConvertFrom-Json</td></tr><tr><td width=50%><b>239</b> }</td><td width=50%><b>239</b> }</td></tr><tr><td width=50%><b>240</b> &nbsp;</td><td width=50%><b>240</b> &nbsp;</td></tr><tr><td width=50%><b>241</b> function GetVersions($alias)</td><td width=50%><b>241</b> function GetVersions($alias)</td></tr><tr><td width=50%><b>242</b> {</td><td width=50%><b>242</b> {</td></tr><tr><td width=50%><b>243</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri "$global:versionsURI/$alias" -Method GET -ContentType "application/json" -Headers $global:Headers -TimeoutSec 3600 -UseBasicParsing</td><td width=50%><b>243</b> &nbsp;&nbsp;&nbsp;&nbsp;$response = Invoke-WebRequest -Uri "$global:versionsURI/$alias" -Method GET -ContentType "application/json" -Headers $global:Headers -TimeoutSec 3600 -UseBasicParsing</td></tr><tr><td width=50%><b>244</b> &nbsp;&nbsp;&nbsp;&nbsp;if($($response.StatusCode) -eq 200 )</td><td width=50%><b>244</b> &nbsp;&nbsp;&nbsp;&nbsp;if($($response.StatusCode) -eq 200 )</td></tr><tr><td width=50%><b>245</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td><td width=50%><b>245</b> &nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width=50%><b>246</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Write-Host $response</td><td width=50%><b>246</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Write-Host $response</td></tr><tr><td width=50%><b>247</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td><td width=50%><b>247</b> &nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width=50%><b>248</b> &nbsp;&nbsp;&nbsp;&nbsp;$versions  = $response | ConvertFrom-Json</td><td width=50%><b>248</b> &nbsp;&nbsp;&nbsp;&nbsp;$versions  = $response | ConvertFrom-Json</td></tr><tr><td width=50%><b>249</b> &nbsp;</td><td width=50%><b>249</b> &nbsp;</td></tr><tr><td width=50%><b>250</b> &nbsp;&nbsp;&nbsp;&nbsp;return $versions</td><td width=50%><b>250</b> &nbsp;&nbsp;&nbsp;&nbsp;return $versions</td></tr><tr><td width=50%><b>251</b> &nbsp;</td><td width=50%><b>251</b> &nbsp;</td></tr><tr><td width=50%><b>252</b> }</td><td width=50%><b>252</b> }</td></tr></table></td></tr></table>
<br><font size='-2' color='#BBBBBB'>S.Rodriguez, May 2003</font></BODY>
</HTML>
